---
import type { CollectionEntry } from 'astro:content';
import BaseLayout from './BaseLayout.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<BaseLayout title={title} description={description}>
    <article class="prose prose-lg prose-stone max-w-none">
        <div class="mb-8 border-b border-gray-200 pb-8">
            {heroImage && <img width={1020} height={510} src={heroImage} alt="" class="rounded-lg mb-6 shadow-md" />}
            <h1 class="text-4xl font-serif font-bold text-gray-900 mb-4">{title}</h1>
            <div class="text-sm text-gray-500 font-mono">
                <time datetime={pubDate.toISOString()}>
                    {pubDate.toLocaleDateString('en-us', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                    })}
                </time>
                {
                    updatedDate && (
                        <div class="italic">
                            Last updated on <time datetime={updatedDate.toISOString()}>
                                {updatedDate.toLocaleDateString('en-us', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric',
                                })}
                            </time>
                        </div>
                    )
                }
            </div>
        </div>
        
        <div class="flex flex-col lg:flex-row gap-12">
            <div class="flex-1 min-w-0">
                <slot />
            </div>
             <!-- TOC will be injected here if I can hook into headings, but for now simple structure -->
             <!-- Actually, Astro MDX layouts don't easily pass headings to the layout without a remark plugin or using the `headings` prop if passed from the page.
                  In the [...slug].astro page I will pass headings to this layout.
             -->
             <aside class="hidden lg:block w-64 flex-shrink-0">
                 <div class="sticky top-8">
                     <span class="text-sm font-bold uppercase tracking-wider text-gray-500 mb-4 block">Table of Contents</span>
                     <ul class="text-sm border-l border-gray-200 pl-4 space-y-2" id="toc-container">
                        <!-- TOC Items will be generated here -->
                     </ul>
                 </div>
             </aside>
        </div>
    </article>
</BaseLayout>

<script>
    // Simple script to generate TOC from h2 and h3 elements
    document.addEventListener('astro:page-load', () => {
        const tocContainer = document.getElementById('toc-container');
        if (tocContainer) {
            const headings = document.querySelectorAll('article h2, article h3');
            headings.forEach(heading => {
                const id = heading.id || heading.textContent?.toLowerCase().replace(/\s+/g, '-');
                heading.id = id;
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${id}`;
                a.textContent = heading.textContent;
                a.className = `block text-gray-600 hover:text-gray-900 transition-colors ${heading.tagName === 'H3' ? 'pl-4' : ''}`;
                li.appendChild(a);
                tocContainer.appendChild(li);
            });
        }
    });
</script>
